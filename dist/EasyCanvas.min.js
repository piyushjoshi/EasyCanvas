/*! EasyCanvas 2014-06-26 */
!function(a){function b(a){a.ContextWrapper||(a.ContextWrapper=d)}function c(a){var b;for(b in e)a.prototype[b.toLowerCase()]=function(){var a=b;return function(){return new e[a](this.getContext())}}()}var d;d=function(a){this.getContext=function(){return a}},d.prototype={constructor:d,beginPath:function(){return this.getContext().beginPath(),this},moveTo:function(a,b){return this.getContext().moveTo(a,b),this},lineTo:function(a,b){return this.getContext().lineTo(a,b),this},strokeColor:function(a){return a&&(this.getContext().strokeStyle=a),this},stroke:function(){return this.getContext().stroke(),this},reset:function(){return this.getContext().canvas.width=this.getContext().canvas.width,this},fillStyle:function(a){return this.getContext().fillStyle=a,this},attach:function(a,b){var c=this.getContext().canvas,d=function(a){var d=c.getBoundingClientRect(),e=window.getComputedStyle(c),f=+e.borderLeftWidth.match(/\d+/)[0],g=+e.borderTopWidth.match(/\d+/)[0],h=+e.paddingLeft.match(/\d+/)[0],i=+e.paddingTop.match(/\d+/)[0];a.x=a.clientX-d.left-f-h,a.y=a.clientY-d.top-g-i,b(a)};return c.addEventListener(a,d,!1),this}};var e={undoingLimit:10};e.Circle=function(a){var b,c={context:a,center_x:0/0,center_y:0/0,radius:0/0,fillStyle:void 0,strokeStyle:void 0,backup:[],backupSize:e.undoingLimit,saveCurrentState:function(){c.backup.length===c.backupSize&&c.backup.shift(),c.backup.push({center_x:c.center_x,center_y:c.center_y,radius:c.radius,fillStyle:c.fillStyle,strokeStyle:c.strokeStyle})},validate:function(){return c.center_x&&c.center_y&&c.radius},angle:2*Math.PI};this.x=function(a){return c.center_x=a,this},this.y=function(a){return c.center_y=a,this},this.radius=function(a){return c.radius=a,this},this.fillColor=function(a){return c.fillStyle=a,this},this.strokeColor=function(a){return c.strokeStyle=a,this},b=function(){c.context.beginPath(),c.context.arc(c.center_x,c.center_y,c.radius,0,c.angle,!1),c.fillStyle&&(c.context.fillStyle=c.fillStyle),c.strokeStyle&&(c.context.strokeStyle=c.strokeStyle),c.saveCurrentState()},this.fill=function(){return c.validate()&&(b(),a.fill()),this},this.stroke=function(){c.validate()&&(b(),a.stroke())}},e.Image=function(a){var b,c={context:a,imageObject:void 0,upperLeft_x:0/0,upperLeft_y:0/0,width:0/0,height:0/0,crop_x:0/0,crop_y:0/0,crop_width:0/0,crop_height:0/0};this.src=function(a){var b;return"string"==typeof a?(b=new window.Image,b.src=a,c.imageObject=b):a instanceof window.Image&&(c.imageObject=a),this},this.upperLeft=function(a,b){return c.upperLeft_x=a,c.upperLeft_y=b,this},this.width=function(a){return c.width=a,this},this.height=function(a){return c.height=a,this},this.cropFrom=function(a,b){return c.crop_x=a,c.crop_y=b,this},this.cropWidth=function(a){return c.cropWidth=a,this},this.cropHeight=function(a){return c.cropHeight=a,this},b=function(a){a.imageObject&&a.upperLeft_x&&a.upperLeft_y&&(a.width&&a.height?a.crop_x&&a.crop_y?(a.crop_width||(a.crop_width=a.width-(a.crop_x-a.upperLeft_x)),a.crop_height||(a.crop_height=a.height-(a.crop_y-a.upperLeft_y)),a.context.drawImage(a.imageObject,a.crop_x,a.crop_y,a.crop_width,a.crop_height,a.upperLeft_x,a.upperLeft_y,a.width,a.height)):a.context.drawImage(a.imageObject,a.upperLeft_x,a.upperLeft_y,a.width,a.height):a.context.drawImage(a.imageObject,a.upperLeft_x,a.upperLeft_y))},this.draw=function(){var a;return c.imageObject.complete?b(c):(a={context:c.context,imageObject:c.imageObject,upperLeft_x:c.upperLeft_x,upperLeft_y:c.upperLeft_y,width:c.width,height:c.height,crop_x:c.crop_x,crop_y:c.crop_y,crop_width:c.crop_width,crop_height:c.crop_height},c.imageObject.addEventListener("load",function(){b(a)},!1)),this}},e.LinearGradient=function(a){var b={start_x:0,start_y:0,end_x:0,end_y:0,colorStops:[],addColorStop:function(a,c){b.colorStops.push({p:a,c:c})},context:a};this.startFrom=function(a,c){return b.start_x=a,b.start_y=c,this},this.endAt=function(a,c){return b.end_x=a,b.end_y=c,this},this.colorStop=function(a,c){return b.addColorStop(a,c),this},this.instantiate=function(){var c=a.createLinearGradient(b.start_x,b.start_y,b.end_x,b.end_y),d=0;for(d=0;d<b.colorStops.length;d++)c.addColorStop(b.colorStops[d].p,b.colorStops[d].c);return c}},e.Rectangle=function(a){var b={topLeft_x:0,topLeft_y:0,context:a,width:0,height:0,applyStyles:function(){b.fillStyle&&(b.context.fillStyle=b.fillStyle),b.strokeStyle&&(b.context.strokeStyle=b.strokeStyle)},backup:[],backupSize:e.undoingLimit,saveCurrentState:function(){b.backup.length===b.backupSize&&b.backup.shift(),b.backup.push({x:b.topLeft_x,y:b.topLeft_y,width:b.width,height:b.height})},resetStateToDefault:function(){b.topLeft_x=0,b.topLeft_y=0,b.width=0,b.height=0,b.saveCurrentState()}};this.x=function(a){return b.topLeft_x=a,this},this.y=function(a){return b.topLeft_y=a,this},this.width=function(a){return b.width=a,this},this.height=function(a){return b.height=a,this},this.fillColor=function(a){return b.fillStyle=a,this},this.strokeColor=function(a){return b.strokeStyle=a,this},this.fill=function(){return b.applyStyles(),b.context.fillRect(b.topLeft_x,b.topLeft_y,b.width,b.height),b.saveCurrentState(),this},this.stroke=function(){return b.applyStyles(),b.context.strokeRect(b.topLeft_x,b.topLeft_y,b.width,b.height),b.saveCurrentState(),this},this.clearAll=function(){var a=b.backup.pop(),c=Math.ceil(a.x)>a.x?a.width+.5:a.width,d=Math.ceil(a.y)>a.y?a.height+.5:a.height;return b.context.clearRect(a.x,a.y,c,d),b.resetStateToDefault(),this},this.clearArea=function(a,c,d,e){return b.context.clearRect(a,c,d,e),this}},e.Text=function(a){var b={context:a,val:void 0,font:void 0,textAlign:void 0,textBaseline:void 0,x:0,y:0,backup:[],backupSize:e.undoingLimit,saveCurrentState:function(){b.backup.length===b.backupSize&&b.backup.shift(),b.backup.push({val:b.val,font:b.font,align:b.align,baseLine:b.baseLine,x:b.x,y:b.y})}};this.val=function(a){return b.val=a,this},this.font=function(a){return b.font=a,this},this.textAlign=function(a){return b.textAlign=a,this},this.textBaseline=function(a){return b.textBaseline=a,this},this.x=function(a){return b.x=a,this},this.y=function(a){return b.y=a,this},this.print=function(){return b.val&&(b.font&&(b.context.font=b.font),b.textBaseline&&(b.context.textBaseLine=b.textBaseLine),b.textAlign&&(b.context.textAlign=b.textAlign),b.context.fillText(b.val,b.x,b.y),b.saveCurrentState()),this}},c(d),b(a)}(window);